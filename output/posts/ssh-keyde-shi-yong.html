<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>SSH Key的使用 | fivewillow</title>

    
            <link href="../assets/css/bitter.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/main.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/code.css" rel="stylesheet" type="text/css">
            <link href="../assets/css/custom.css" rel="stylesheet" type="text/css">

    
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

      <link rel="canonical" href="http://fivewillow.github.io/posts/ssh-keyde-shi-yong.html">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    


    

    <meta name="author" content="lawrence lin">
    
    <meta property="og:site_name" content="fivewillow">
    <meta property="og:title" content="SSH Key的使用">
    <meta property="og:url" content="http://fivewillow.github.io/posts/ssh-keyde-shi-yong.html">
    <meta property="og:description" content="進入ssh目錄
首先先到個人的 ssh目錄
$ cd ~/.ssh



如果沒有這個目錄, 需手動建一個
$ mkdir .ssh



建立新的 SSH key
產生一個新的SSH key, 可以使用下列指令
$ ssh-keygen -t rsa



依照提示, 輸入你的密碼後,就可以在 .ssh目錄下看到 id_rsa及id_rsa.pub,這二個檔.id_rsa.pub 就是公鑰, 而">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2015-04-20T18:47:24+08:00">

    

    



</head>
<body>
    <section class="social">
        <ul>
        
            <li><a href="../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>

        </ul>
    </section>
    <section class="page-content">
        <div class="content" rel="main">
            
    <div class="post">
    
    <h1 class="p-name entry-title" itemprop="headline name">SSH Key的使用</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2015-04-20T18:47:24+08:00">2015-04-20 18:47</time>
            

            

            </div>
            

        </div>
        <div class="body">
            <div>
<h5>進入ssh目錄</h5>
<p>首先先到個人的 ssh目錄</p>
<pre class="code literal-block"><span class="nv">$ </span><span class="nb">cd</span> ~/.ssh
</pre>


<p>如果沒有這個目錄, 需手動建一個</p>
<pre class="code literal-block"><span class="nv">$ </span>mkdir .ssh
</pre>


<h5>建立新的 SSH key</h5>
<p>產生一個新的SSH key, 可以使用下列指令</p>
<pre class="code literal-block"><span class="nv">$ </span>ssh-keygen -t rsa
</pre>


<p>依照提示, 輸入你的密碼後,就可以在 <code>.ssh</code>目錄下看到 <code>id_rsa</code>及<code>id_rsa.pub</code>,這二個檔.<code>id_rsa.pub</code> 就是公鑰, 而</p>
<!-- TEASER_END -->

<h5>將公鑰放入主機</h5>
<p>先把公鑰放到主機</p>
<pre class="code literal-block"><span class="nv">$ </span>scp ~/.ssh/*.pub <span class="o">[</span>目的主機<span class="o">]</span>:~/.ssh/.
</pre>


<p>登入主機</p>
<pre class="code literal-block"><span class="nv">$ </span>ssh <span class="o">[</span>username<span class="o">]</span>@<span class="o">[</span>目的主機<span class="o">]</span>
</pre>


<p>把公鑰存到主機. 系統預設處理公鑰的檔案為<code>authorized_keys</code>,這個檔案必須把權限設為只有使用者具有寫的權限</p>
<pre class="code literal-block"><span class="nv">$ </span>cat ~/.ssh/identity.pub &gt;&gt; ~/.ssh/authorized_keys
<span class="nv">$ </span>chmod <span class="m">711</span> ~/.ssh
<span class="nv">$ </span>chmod <span class="m">644</span> ~/.ssh/authorized_keys
</pre>


<h5>設定 <code>ssh-agent</code>
</h5>
<p>起動 ssh-agent</p>
<pre class="code literal-block"><span class="nv">$ </span><span class="nb">eval</span> <span class="sb">`</span>ssh-agent -s<span class="sb">`</span>
</pre>


<p>新增 key</p>
<pre class="code literal-block"><span class="nv">$ </span>ssh-add
</pre>


<h5>自動化執行</h5>
<p>參考<a href="http://www.cygwin.com/ml/cygwin/2001-06/msg00537.html" title="useful cygwin ssh-agent script">Joseph M. Reagle Jr.</a></p>
<p>放在 .bash_profile 的 script</p>
<p>SH_ENV="$HOME/.ssh/environment"</p>
<pre class="code literal-block">    function start_agent {
       echo "Initialising new SSH agent..."
       /usr/bin/ssh-agent | sed 's/^echo/#echo/' &gt; "<span class="cp">${</span><span class="n">SSH_ENV</span><span class="cp">}</span>"
       echo succeeded
       chmod 600 "<span class="cp">${</span><span class="n">SSH_ENV</span><span class="cp">}</span>"
       . "<span class="cp">${</span><span class="n">SSH_ENV</span><span class="cp">}</span>" &gt; /dev/null
    /usr/bin/ssh-add;
    }

    # Source SSH settings, if applicable

    if [ -f "<span class="cp">${</span><span class="n">SSH_ENV</span><span class="cp">}</span>" ]; then
       . "<span class="cp">${</span><span class="n">SSH_ENV</span><span class="cp">}</span>" &gt; /dev/null
       #ps <span class="cp">${</span><span class="n">SSH_AGENT_PID</span><span class="cp">}</span> doesn’t work under cywgin
       ps -ef | grep <span class="cp">${</span><span class="n">SSH_AGENT_PID</span><span class="cp">}</span> | grep ssh-agent$ &gt; /dev/null || {
       start_agent;
   }
    else
     start_agent;
    fi
</pre>


<h5>使用 ssh config 來對映多個ssh 帳號</h5>
<p>編輯<code>~/.ssh/config</code>, 如果沒有就建一個. 文件格式為</p>
<pre class="code literal-block">        Host [名稱]
            HostName [主機名]
            User [使用者登入ID]
            IdentityFile [私鑰路徑]
</pre>
</div>
        </div>
        

        

    </div>



             
        <footer id="footer" role="contentinfo">
            <p>Contents © 2015         <a href="mailto:twsmallin@gmail.com">lawrence lin</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>

        </div>
    </section>
    
    
    
            <script src="../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script>
            <script src="../assets/js/jquery.timeago.js" type="text/javascript"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    
        <script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
    
</body>
</html>
